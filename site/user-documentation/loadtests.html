<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at May 30, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20130530" />
    <meta http-equiv="Content-Language" content="en" />
    <title>GrinderScript.Net - </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.3.0.min.js"></script>

    
            </head>
        <body class="topBarDisabled">
          
    
    
            
    
        
    <a href="http://github.com/ebjornset/GrinderScript.Net.git">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>GrinderScript.Net</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2013-05-30</li>
                  <li class="divider">|</li> <li id="projectVersion">Version: 1.0.3</li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">User documentation</li>
                                
      <li>
    
                          <a href="../index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li>
    
                          <a href="../user-documentation/installation.html" title="Installation">
          <i class="none"></i>
        Installation</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Writing load tests</a>
          </li>
                  
      <li>
    
                          <a href="../user-documentation/datapools.html" title="Using data pools">
          <i class="none"></i>
        Using data pools</a>
            </li>
                  
      <li>
    
                          <a href="../user-documentation/scenarios.html" title="Composing test scenarios">
          <i class="none"></i>
        Composing test scenarios</a>
            </li>
                  
      <li>
    
                          <a href="../user-documentation/properties.html" title="grinder.properties">
          <i class="none"></i>
        grinder.properties</a>
            </li>
                              <li class="nav-header">Developer documentation</li>
                                
      <li>
    
                          <a href="../developer-documentation/development-environment.html" title="Environment">
          <i class="none"></i>
        Environment</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                      
      <li>
    
                          <a href="../project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                    
      <li>
    
                          <a href="../project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                   
    <script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>

    
    <div class="g-plusone" data-href="http://GrinderScript.Net/" data-size="tall" ></div>

                   <div class="clear"></div>
                   
        
        
        
    <iframe src="http://www.facebook.com/plugins/like.php?href=http://GrinderScript.Net/&send=false&layout=box_count&show-faces=false&action=like&colorscheme=light"
        scrolling="no" frameborder="0"
        style="border:none; width:48px; height:63px; margin-top: 10px;" ></iframe>
               <div class="clear"></div>
               
        
        
        <div id="twitter">
    
    <a href="https://twitter.com/GrinderScriptDN" class="twitter-follow-button" data-show-count="true" data-align="left" data-size="medium" data-show-screen-name="false" data-lang="en">Follow GrinderScriptDN</a>
    <script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        </div>
                   <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Writing load tests with GrinderScript.Net</h1><p>The GrinderScript.Net NuGet samples package contains some ready to use examples. You should install the package into your load test project before you proceed, so you have some living code to play with while you read this. You install the sample package the normal NuGet way, from the <i>Visual Studio NuGet Package Manager</i>:</p><p><tt>install-package GrinderScript.Net.Samples</tt></p><p>A load test class is called a <i>Worker</i> in GrinderScript.Net. The Grinder will spin up as many instances of your worker class as you specify with the <tt>grinder.threads</tt> property in your <tt>grinder.properties</tt> file. It will also control the lifetime of these instances for you. You can safely use member variables to store state used by your test methods, as long as you dont start to do you own thread management inside your worker instance.</p><div class="section"><h2>The fundamental concepts of a Worker<a name="The_fundamental_concepts_of_a_Worker"></a></h2><p>At its core a Worker type must implement the <tt>GrinderScript.Net.Core.IGrinderWorker</tt> interface:</p>
<div class="source"><pre class="prettyprint">public interface IGrinderWorker
{
    void Initialize();

    void Run();

    void Shutdown();
}
</pre></div><p>You will probably not implement this interface from scratch, since GrinderScript.Net comes with several base classes you can inherit from. Still, its good to know that the life cycle of an <i>IGrinderWorker</i>, which is</p>
<ol style="list-style-type: decimal">
  <li><i>Initialize()</i> is called once after construction. In this method you setup the fixture you need for your test, like registering your test method(s) with GrinderScript.Net. Youll see examples of how you register your test methods further down.</li>
  <li><i>Run()</i> is called as many times as specified in the <tt>grinder.runs</tt> property. You normally call your test methods from this method.</li>
  <li><i>Shutdown()</i> is called once after the test run is complete. In this method you should close any open resources. You should also clear all references to objects living in the JVM, otherwise youll might get circular references between the CLR and JVM, causing memory leaks.</li>
</ol><p>When you register a test method in GrinderScript.Net it will be proxied by The Grinder as a JVM object that is returned to you as an <i>IGrinderTest</i> instance. Each time you call <i>Run()</i> on this proxy The Grinder will call your method, time the call duration, and update its statistics with the call metrics. A test method is just an Action, so any zero argument void method or lambda expression can be used. From each Run() you can call as many test methods as you need and also call them in loops if that makes sense in your test scenario.</p></div><div class="section"><h2>Writing a worker that inherits from GrinderScript.Nets DefaultWorker<a name="Writing_a_worker_that_inherits_from_GrinderScript.Netnulls_DefaultWorker"></a></h2><p>The easiest way to write a load test is to extend GrinderScript.Net's <tt>GrinderScript.Net.Core.DefaultWorker</tt>. <i>DefaultWorker</i> will help you manage the worker life cycle and test registration described above. Here is an example of a simple load test extending the <i>DefaultWorker</i>:</p>
<div class="source"><pre class="prettyprint">public class WorkerThatLogs : DefaultWorker
{
    protected override void DefaultInitialize()
    {
        AddTest(1001, &quot;Logger.TraceMessage&quot;, TraceMessage);
        AddTest(2001, &quot;Logger.DebugMessage&quot;, DebugMessage);
    }

    private void TraceMessage()
    {
        Logger.Trace(&quot;Example trace message&quot;);
    }

    private void DebugMessage()
    {
        Logger.Debug(&quot;Example debug message&quot;);
    }
}
</pre></div><p>Here we use the <i>AddTest()</i> utility method to register two test methods, <i>TraceMessage()</i> and <i>DebugMessage()</i> with GrinderScript.Net. For each time The Grinder call our <i>Run()</i> method, the <i>DefaultWorker</i> will call the <i>IGrinderTest</i> proxies for two methods. If you run this test from The Grinder console, your <i>Results</i> tab will look something like this:</p><p><img src="./images/example-grinder-run-01.png" alt="The Grinder Console Result tab when running the WorkerThatLogs test" /></p>
<table border="0" class="table table-striped">
    <tr class="a">
        <td colspan="4">The core of the <i>DefaultWorker</i> is the <i>AddTest()</i> utility method. If takes these arguments six argument, where the forst tree are mandatory</td>
    </tr>
    <tr class="b">
        <td><i>Name</i></td>
        <td><i>Type</i></td>
        <td><i>Description</i></td>
        <td><i>Default value</i></td>
    </tr>
    <tr class="a">
        <td>testNumber</td>
        <td>int</td>
        <td>This is used by The Grinder to identify each test. The Grinder will accumulate test statistics for each test number. The Grinder allow you to register several test methods with the same test number, so you should make your own routine if you have special requirements regarding test numbers. The test number shows up in the The Grinder Console Results tab in the Test column. This argument is mandatory.</td>
        <td>None</td>
    </tr>
    <tr class="b">
        <td>testDescription</td>
        <td>string</td>
        <td>A human readable description of the test. The Grinder Console will display this in the Description column of the Results tab. This argument is mandatory.</td>
        <td>None</td>
    </tr>
    <tr class="a">
        <td>testAction</td>
        <td>Action</td>
        <td>The actual test method that will be called with instrumentation. This argument is mandatory.</td>
        <td>None</td>
    </tr>
    <tr class="b">
        <td>beforeTestAction</td>
        <td>Action</td>
        <td>If provided, this method will be called <b>without</b> instrumentation before the actual test method is called. Her you can perform test fixture setup, without impacting the metrics for the test.</td>
        <td>null</td>
    </tr>
    <tr class="a">
        <td>afterTestAction</td>
        <td>Action</td>
        <td>If provided, this method will be called <b>without</b> instrumentation after the actual test method is called. Her you can perform test fixture cleanup, without impacting the metrics for the test.</td>
        <td>null</td>
    </tr>
    <tr class="b">
        <td>sleepMillis</td>
        <td>int</td>
        <td>How many milliseconds should The Grinder sleep after this test method is called? You can use normal Grinder properties <i>grinder.sleepTimeFactor</i> and <i>grinder.sleepTimeVariation</i> to control this sleep time during your load test runs.</td>
        <td>1000</td>
    </tr>
</table><p>Sometimes you want to call the same method several times from a load test. The <i>DefaultWorker</i> has an <i>AddTest()</i> overload for helping with this. This overload takes an already proxied test method as the only argument. Here is an extension of the example above, where the <i>TraceMessage()</i> is added twice:</p>
<div class="source"><pre class="prettyprint">    protected override void DefaultInitialize()
    {
        var traceMessageTest = AddTest(1001, &quot;Logger.TraceMessage&quot;, TraceMessage);
        AddTest(2001, &quot;Logger.DebugMessage&quot;, DebugMessage);
        AddTest(traceMessageTest);
    }
</pre></div><p>With this test setup each call to <i>Run()</i> will perform the test sequence <i>TraceMessage()</i>, <i>DebugMessage()</i>, <i>TraceMessage()</i>, so your load test will perform twice as many <i>TraceMessage()</i> calls as <i>DebugMessage()</i> calls.</p>
<table border="0" class="table table-striped">
    <tr class="a">
        <td colspan="2">Beside the mandatory <i>DefaultInitialize()</i> described above, <i>DefaultWorker</i> also provide these extension tree points</td>
    </tr>
    <tr class="b">
        <td><i>Method</i></td>
        <td><i>Description</i></td>
    </tr>
    <tr class="a">
        <td>DefaultBeforeRun()</td>
        <td>This method is called for each <i>Run()</i>, <b>before</b> all the tests you've added with <i>AddTest()</i>. You can use this method if you have some test fixture setup you need to perform before each <i>Run()</i>.</td>
    </tr>
    <tr class="b">
        <td>DefaultAfterRun()</td>
        <td>This method is called for each <i>Run()</i>, <b>before</b> all the tests you've added with <i>AddTest()</i>. You can use this method if you have some test fixture setup you need to perform before each <i>Run()</i></td>
    </tr>
    <tr class="a">
        <td>DefaultShutdown()</td>
        <td>This method is called during <i>Shutdown()</i>, after all the test references has been cleared. Her you can close all resources you've hold for the whole load test run. You should also clear all JVM references you hold.</td>
    </tr>
</table></div><div class="section"><h2>Writing a worker from scratch<a name="Writing_a_worker_from_scratch"></a></h2><p>If you find the <i>DefaultWorker</i> to limiting, GrinderScript.Net also provide an <tt>GrinderScript.Net.Core.AbstractWorker</tt> that you can extend from. Beside the glue functionality described below the <i>AbstractWorker</i> provide you with tree methods to override, <i>OnInitialize()</i>, <i>OnRun()</i> and <i>OnShutdown()</i>. Hopefully youve picked up when and how to use these methods by now.</p>
<table border="0" class="table table-striped">
    <tr class="a">
        <td colspan="3">The <i>AbstractWorker</i> provide tree member variables for you to use when writing your load tests.</td>
    </tr>
    <tr class="b">
        <td><i>Member</i></td>
        <td><i>Type</i></td>
        <td><i>Description</i></td>
    </tr>
    <tr class="a">
        <td>GrinderContext</td>
        <td>GrinderScript.Net.Core.IGrinderContext</td>
        <td>This is your bridge to The Grinder it self. You use this to read various load run information, like the <i>grinder.properties</i>, to register test methods for timing by The Grinder and to interact with the sleep functionality in The Grinder. This is a singleton instance living in the JVM, so you must pass this on to any objects you create that need to interact with The Grinder.</td>
    </tr>
    <tr class="b">
        <td>Logger</td>
        <td>GrinderScript.Net.Core.IGrinderLogger</td>
        <td>This is a CLR wrapper around a logger instance in the JVM. It makes it possible to integrate your own logging into The Grinder's logs.</td>
    </tr>
    <tr class="a">
        <td>TypeHelper</td>
        <td>GrinderScript.Net.Core.Framework.TypeHelper</td>
        <td>As the name indicates, this is a helper object to instantiate a type, either from it's name, or from a value read from the <i>grinder.properties</i></td>
    </tr>
</table><p>As a side note, the <i>DefaultWorker</i> extends the <i>AbstractWorker</i>.</p></div><div class="section"><h2>Writing your own Script Engine<a name="Writing_your_own_Script_Engine"></a></h2><p><a name="ScriptEngine" id="ScriptEngine"></a> The purpose of a script engine is to create worker instances on demand of The Grinder. Beside that its also notified when the load run process is initialized and shutdown, so it can do any process initialization/finalization work need by your workers. A Script Engine type must implement the <tt>GrinderScript.Net.Core.IGrinderScriptEngine</tt> interface:</p>
<div class="source"><pre class="prettyprint">public interface IGrinderScriptEngine
{
    void Initialize();

    IGrinderWorker CreateWorkerRunnable();

    void Shutdown();
}
</pre></div><p>GrinderScript.Nets default script engine, <tt>GrinderScript.Net.Core.DefaultScriptEngine</tt>, creates the workers by instantiating the type you configure with the <i>grinderscript-dotnet.workerType</i> property, and is ready for you to use right out of the box. But you might have special process initialization/finalization needs, or need some additional initialization of all your worker instances, or do not fancy using the <i>grinderscript-dotnet.workerType</i> property to specify your worker type. In any of these case you can extend the DefaultScriptEngineor its base class, the <tt>GrinderScript.Net.Core.AbstractScriptEngine</tt>. Both options p provides you with tree methods to override, <i>OnInitialize()</i>, <i>OnCreateWorkerRunnable()</i> and <i>OnShutdown()</i>. Youve probably figured out what code goes in each method already, if not you can look at the script engine types in the samples code. Below is all the code in the <i>DefaultWorker</i>, as an example of how to override the <i>OnCreateWorkerRunnable()</i>.</p>
<div class="source"><pre class="prettyprint">public class DefaultScriptEngine : AbstractScriptEngine, IDatapoolFactoryAware
{
    protected override IGrinderWorker OnCreateWorkerRunnable()
    {
        Logger.Trace(&quot;OnCreateWorkerRunnable: Enter&quot;);
        var result = CreateGrinderWorkerFromProperty();
        Logger.Trace(m =&gt; m(&quot;OnCreateWorkerRunnable: Exit, result = {0}&quot;, result));
        return result;
    }

    public IDatapoolFactory DatapoolFactory { get; set; }
}
</pre></div><p>You replace the default script engine with your own by using the <tt>grinderscript-dotnet.scriptEngineType</tt> property in your <tt>grinder.properties</tt> file, e.g. <tt>grinderscript-dotnet.scriptEngineType=GrinderScript.Net.Verifier.Samples.GrinderScript.Net.Core.ScriptEngineThatCreateWorkerByCtor, GrinderScript.Net.Verifier</tt></p><p>Extending the <i>DefaultScriptEngine</i> or the <i>AstractScriptEngine</i> is much a matter of taste (beside what makes you the least code to get your work done).</p></div><div class="section"><h2>What's next<a name="Whats_next"></a></h2><p>By now you should understand how to write your load tests with GrinderScript.Net. The natural next step now is to learn how to <a href="./datapools.html" title="Using data pools in GriderScript.Net page">use data pools to varying test data</a> or how to <a href="./scenarios.html" title="Composing test scenarios with GrinderScript.Net page">compose workers into load test scenarios</a>. You can also check out the <a href="./properties.html" title="Complete list of properties used by GrinderScript.Net page">complete list of properties</a> used by GrinderScript.Net.</p></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2013.
          All Rights Reserved.      
                    
      </div>

        
        
          
    
    
                
    <div id="ohloh" class="pull-right">
      <script type="text/javascript" src="http://www.ohloh.net/p/641494/widgets/project_users.js"></script>
    </div>
        </div>
    </footer>
  </body>
</html>
